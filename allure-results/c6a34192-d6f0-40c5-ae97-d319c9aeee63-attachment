# Instructions

- Following Playwright test failed.
- Explain why, be concise, respect Playwright best practices.
- Provide a snippet of code with the fix, if possible.

# Test info

- Name: Generate and Verify Enrollment Link
- Location: /Users/pejin/Documents/Playwright QA/tests/test-1.spec.ts:3:5

# Error details

```
TimeoutError: locator.waitFor: Timeout 5000ms exceeded.
Call log:
  - waiting for locator('textarea.slds-textarea').nth(1) to be visible

    at /Users/pejin/Documents/Playwright QA/tests/test-1.spec.ts:21:21
```

# Page snapshot

```yaml
- link "Skip to Navigation"
- link "Skip to Main Content"
- text: "Sandbox: qa |"
- link "Log out"
- text: Brella Concierge
- button "Search": Search...
- navigation "Global Header":
  - list:
    - listitem:
      - group:
        - button "Favorite this item":
          - tooltip "Add favorite"
        - button "Favorites list":
          - tooltip "Favorites list"
    - listitem
    - listitem:
      - button "Guidance Center"
      - tooltip "Guidance Center"
    - listitem:
      - button "Salesforce Help":
        - tooltip "Salesforce Help"
    - listitem:
      - button "Setup":
        - tooltip "Setup"
    - listitem:
      - button "Notifications":
        - tooltip "Notifications"
    - listitem:
      - button "View profile":
        - tooltip "View profile"
- navigation "App":
  - button "App Launcher"
- heading "Brella Concierge" [level=1]
- navigation "Global":
  - list:
    - listitem:
      - link "Accounts"
      - button "Accounts List"
    - listitem:
      - link "Contacts"
      - button "Contacts List" [expanded]
      - menu:
        - menuitem "New Contact"
        - text: Recent records
        - menuitem "Delilah Kannon"
        - menuitem "MailenBill FloridaIInc"
        - menuitem "Mailen ERWhite"
        - menuitem "Ben Dewalt"
        - menuitem "Freyja Alex"
        - text: Recent lists
        - menuitem "All Contacts"
        - menuitem "Employee & Dependants"
        - menuitem "Open \"Delilah Kannon | Co...\" in New Tab"
    - listitem:
      - link "Quotes |Ansel"
    - listitem:
      - link "|Sym"
    - listitem:
      - link "|NW"
    - listitem:
      - link "|Voya"
    - listitem:
      - link "Contracts |Ansel"
    - listitem:
      - link "|Sym"
    - listitem:
      - link "|NW"
    - listitem:
      - link "|Voya"
    - listitem:
      - link "All Assets"
    - listitem:
      - link "Claims"
      - button "Claims List"
    - listitem:
      - button "Show more navigation items"
    - listitem:
      - button "Edit nav items"
- main:
  - img "Contact"
  - heading "Contact Delilah Kannon" [level=1]
  - button "View Contact Hierarchy"
  - button "Follow"
  - button "New Case Message"
  - button "Create Claim"
  - button "Change Concierge ID"
  - button "Change Email"
  - button "Show more actions"
  - listitem:
    - paragraph: Account Name
    - paragraph:
      - link "Automation ER 1740580143"
      - button "Open Automation ER 1740580143 Preview Open Automation ER 1740580143 Preview"
  - listitem:
    - paragraph: Email
    - paragraph:
      - link "igor.pejin+ba593303706@joinansel.com"
  - listitem:
    - paragraph: Contact Record Type
    - paragraph: Member
  - listitem:
    - paragraph: Concierge Id
    - paragraph
  - heading "Tabs" [level=2]
  - tablist "Tabs":
    - tab "Details" [selected]
    - tab "Related"
    - tab "Group & Contract"
  - tabpanel "Details":
    - heading "Contact Information" [level=3]:
      - button "Contact Information" [expanded]
    - term: https://playwright.dev/
    - definition:
      - button "Edit https://playwright.dev/"
    - heading "Demographic information" [level=3]:
      - button "Demographic information" [expanded]
    - term: Name
    - definition:
      - text: Delilah Kannon
      - button "Edit Name"
    - term: Contact Record Type
    - definition:
      - text: Member
      - button "Change Record Type"
    - term: MemberId
    - definition:
      - text: "48620877001"
      - button "Edit MemberId"
    - term: Role
    - definition:
      - text: Primary
      - button "Edit Role"
    - term: Roster Member
    - definition:
      - link "Delilah Kannon"
      - button "Open Delilah Kannon Preview Open Delilah Kannon Preview"
      - button "Edit Roster Member"
    - term: Billing Account
    - definition:
      - button "Edit Billing Account"
    - term: Birthdate
    - definition:
      - text: 11/12/1978
      - button "Edit Birthdate"
    - term: Concierge Id
    - definition:
      - button "Edit Concierge Id"
    - term: Phone
    - definition:
      - button "Edit Phone"
    - term: Age
    - definition: "46"
    - term: Social Security Number
    - definition:
      - text: 672-06-1075
      - button "Edit Social Security Number"
    - term: Mobile
    - definition:
      - link "234-545-678"
      - button "Edit Mobile"
    - term: Gender
    - definition:
      - text: Female
      - button "Edit Gender"
    - term: Email
    - definition:
      - link "igor.pejin+ba593303706@joinansel.com"
      - button "Edit Email"
    - term: EA User
    - definition:
      - button "Edit EA User"
    - term: Is Disabled
    - definition:
      - button "Edit Is Disabled"
    - term: Test
    - definition:
      - button "Edit Test"
    - term: Mailing Address
    - definition:
      - link "Ocean view Miami, Florida 45600"
      - button "Edit Mailing Address"
    - term: Student Type
    - definition:
      - button "Edit Student Type"
    - term: Preferred Payment Method
    - definition:
      - button "Edit Preferred Payment Method"
    - term: Strategic Partner Name
    - definition:
      - text: Brella
      - button "Edit Strategic Partner Name"
    - term: E-Consent Timestamp
    - definition:
      - button "Edit E-Consent Timestamp"
    - term: Screening Trigger
    - definition:
      - button "Edit Screening Trigger"
    - term: Has member portal account
    - definition:
      - button "Edit Has member portal account"
    - term: Account Name
    - definition:
      - link "Automation ER 1740580143"
      - button "Open Automation ER 1740580143 Preview Open Automation ER 1740580143 Preview"
      - button "Edit Account Name"
    - paragraph: Active Coverage
    - paragraph: NO ACTIVE COVERAGE
    - paragraph: QLE Recents
    - paragraph: Event/Date
    - paragraph
    - heading "Roster Family Member (2)" [level=2]
    - paragraph:
      - text: Navigation Mode
      - grid:
        - rowgroup:
          - row "Name Role Member contact record Age Status":
            - columnheader "Name":
              - 'button "Sort by: Name"'
              - text: "Sorted: None"
            - columnheader "Role":
              - 'button "Sort by: Role"'
              - text: "Sorted: None"
            - columnheader "Member contact record":
              - 'button "Sort by: Member contact record"'
              - text: "Sorted: None"
            - columnheader "Age":
              - 'button "Sort by: Age"'
              - text: "Sorted: None"
            - columnheader "Status":
              - 'button "Sort by: Status"'
              - text: "Sorted: None"
        - rowgroup:
          - row "Jeff Demo Spouse Jeff Demo 57 Active":
            - rowheader "Jeff Demo":
              - link "Jeff Demo"
            - gridcell "Spouse"
            - gridcell "Jeff Demo":
              - link "Jeff Demo"
            - gridcell "57"
            - gridcell "Active"
          - row "Mike Demo Child Mike Demo 20 Active":
            - rowheader "Mike Demo":
              - link "Mike Demo"
            - gridcell "Child"
            - gridcell "Mike Demo":
              - link "Mike Demo"
            - gridcell "20"
            - gridcell "Active"
    - article:
      - text: Indicates Case
      - heading "Assets (1)" [level=2]
      - button "Indicates refresh action"
      - table:
        - rowgroup:
          - row "Asset Name Serial Number Version Effective Date Version Expiration Date Is Virtual Asset":
            - columnheader "Asset Name"
            - columnheader "Serial Number"
            - columnheader "Version Effective Date"
            - columnheader "Version Expiration Date"
            - columnheader "Is Virtual Asset"
            - cell
        - rowgroup:
          - row "Delilah, Kannon Employee + Spouse | 2025 48620877 5/1/2025 1/31/2026 Actions":
            - cell "Delilah, Kannon Employee + Spouse | 2025":
              - link "Delilah, Kannon Employee + Spouse | 2025"
            - cell "48620877":
              - link "48620877"
            - cell "5/1/2025"
            - cell "1/31/2026"
            - cell:
              - checkbox
            - cell "Actions":
              - button "Actions"
      - link "View All"
    - article "Case Messages":
      - article:
        - heading "Case Messages" [level=2]
    - article "Cases":
      - article:
        - heading "Cases" [level=2]
    - article:
      - heading "Claims" [level=2]
    - article "Payment Methods":
      - article:
        - heading "Payment Methods" [level=2]
    - paragraph: System Events
    - paragraph: Last Login
    - paragraph: Has Bounced
    - paragraph: "false"
    - paragraph: Has Clicked
    - paragraph: "false"
    - paragraph: Has Member Account
    - paragraph: "true"
    - paragraph: E-Consent
    - paragraph
    - paragraph: Has Opened
    - paragraph: "false"
    - list:
      - listitem:
        - heading "History of System Emails sent and logins" [level=2]:
          - button "History of System Emails sent and logins"
  - article "Notes":
    - heading "Notes (0)" [level=2]:
      - link "Notes (0)"
    - button "Show actions for Notes"
  - text: Follow-ups
  - list
  - text: Communications
  - list
  - heading "Tabs" [level=2]
  - tablist "Tabs":
    - tab "Activity" [selected]
    - tab "Chatter"
  - tabpanel "Activity":
    - heading "Activity Publisher" [level=2]
    - group:
      - button "Log a Call": Log a Call Log a Call
      - button "More Log a Call Actions"
    - group:
      - button "New Task": New Task New Task
      - button "More New Task Actions"
    - group:
      - button "Email": Email Email
      - button "More Email Actions"
    - heading "Activity Timeline" [level=2]
    - link "Skip to the bottom of the activity timeline"
    - text: "Filters: All time â€¢ All activities â€¢ All types"
    - button "Timeline Settings"
    - button "Refresh"
    - text: â€¢
    - button "Expand All"
    - text: â€¢
    - link "View All"
    - heading "Upcoming & Overdue" [level=3]:
      - button "Upcoming & Overdue" [expanded]
    - list
    - text: No activities to show. Get started by sending an email, scheduling a task, and more.
    - heading "March â€¢ 2025 This Month" [level=3]:
      - button "March â€¢ 2025 This Month" [expanded]
    - list:
      - listitem:
        - button "Details for"
        - img "Task"
        - link "2025-03-21 - Created Member Account":
          - deletion: 2025-03-21 - Created Member Account
        - text: Mar 21
        - button "Show more actions"
        - link "Partner Brella"
        - text: had a task
      - listitem:
        - button "Details for"
        - img "Task"
        - link "2025-03-04 - Brella FAQ - Opened":
          - deletion: 2025-03-04 - Brella FAQ - Opened
        - text: Mar 4
        - button "Show more actions"
        - link "Partner Brella"
        - text: had a task
      - listitem:
        - button "Details for"
        - img "Task"
        - link "2025-03-03 - Brella FAQ - Sent":
          - deletion: 2025-03-03 - Brella FAQ - Sent
        - text: Mar 3
        - button "Show more actions"
        - link "Partner Brella"
        - text: had a task
    - status: No more past activities to load.
    - link "Skip to the top of the activity timeline"
  - article:
    - heading "Cases" [level=2]
- status
```

# Test source

```ts
   1 | import { test, expect } from '@playwright/test';
   2 |
   3 | test('Generate and Verify Enrollment Link', async ({ page }) => {
   4 |   console.log('ðŸš€ Starting test: Generate and Verify Enrollment Link');
   5 |
   6 |   // Step 1: Navigate to Salesforce Login Page
   7 |   await page.goto('https://brella--qa.sandbox.lightning.force.com/lightning/r/Lead/00QQL00000G25ae2AB/view');
   8 |
   9 |   // Step 2: Log in to Salesforce
  10 |   await page.getByRole('textbox', { name: 'Username' }).fill('qa@joinansel.com.qa');
  11 |   await page.getByRole('textbox', { name: 'Password' }).fill('q8xPmBoudN1W');
  12 |   await page.getByRole('button', { name: 'Log In to Sandbox' }).click();
  13 |
  14 |
  15 |   // Step 4: Open "Details" tab and click "Get The Link"
  16 |   await page.getByRole('tab', { name: 'Details' }).click();
  17 |   await page.getByRole('button', { name: 'Contacts' }).click();
  18 |
  19 |   // Step 5: Extract the Enrollment Link from the second textarea
  20 |   const linkLocator = page.locator('textarea.slds-textarea').nth(1);
> 21 |   await linkLocator.waitFor({ state: 'visible', timeout: 5000 });
     |                     ^ TimeoutError: locator.waitFor: Timeout 5000ms exceeded.
  22 |
  23 |   // Step 6: Retry extraction if necessary
  24 |   let enrollmentLink = '';
  25 |   for (let i = 0; i < 5; i++) {
  26 |     enrollmentLink = await linkLocator.inputValue();
  27 |     if (enrollmentLink.trim()) break; // Stop if value is found
  28 |     await page.waitForTimeout(1000);
  29 |   }
  30 |
  31 |   // Step 7: Validate the extracted link
  32 |   //console.log(`ðŸ”— Extracted Enrollment Link: ${enrollmentLink}`);
  33 |   //expect(enrollmentLink).not.toBe('');
  34 |   //expect(enrollmentLink).toMatch(/^https:\/\/qa-ansel-platform\.joinansel\.com\/enrollment\/\?token=.*/);
  35 |  // console.log('âœ… Enrollment link is valid.');
  36 |
  37 |   // Step 8: Navigate to the extracted link
  38 |   await page.goto(enrollmentLink, { waitUntil: 'domcontentloaded' });
  39 |   console.log('ðŸŽ¯ Successfully navigated to the generated enrollment link!');
  40 | });
```